<?xml version="1.0" encoding="UTF-8"?>

<odoo noupdate="0">

  <!-- VIEWS: "student"

            - Model·········: academy.student
            - _rec_name·····: name
            - Domain········: []
            - Context·······: {}
            - Parent menu ··: academy_base.menu_academy_monitoring
            - View priority·: 16    Sequence····: 10
            - Action help···: Here are not students
        - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

  <!-- List view for "academy.student" -->
  <record id="view_academy_student_tree" model="ir.ui.view">
    <field name="name">view.academy.student.tree</field>
    <field name="model">academy.student</field>
    <field name="type">list</field>
    <field name="mode">primary</field>
    <field name="priority" eval="16"/>
    <field name="active" eval="True"/>
    <field name="inherit_id" ref="academy_base.view_academy_support_staff_tree"/>
    <field name="arch" type="xml">
      <xpath expr="//field[@name='vat']" position="before">
        <field name="signup_code" class="oe_field_signup_code" string="Sign-up code" readonly="1"/>
        <field name="signup_date" class="oe_field_signup_date" widget="date" />
      </xpath>
      <xpath expr="//list" position="attributes">
        <attribute name="string">academy_student_tree</attribute>
      </xpath>
      <xpath expr="//list" position="inside">
        <field name="enrolment_str" class="oe_field_enrolment_str text-center" optional="show"/>
      </xpath>
    </field>
  </record>

  <!-- Form view for "academy.student" -->
  <record id="view_academy_student_form" model="ir.ui.view">
    <field name="name">view.academy.student.form</field>
    <field name="model">academy.student</field>
    <field name="type">form</field>
    <field name="mode">primary</field>
    <field name="priority" eval="16"/>
    <field name="active" eval="True"/>
    <field name="inherit_id"/>
    <field name="inherit_id" ref="academy_base.view_academy_support_staff_form"/>
    <field name="arch" type="xml">
      <xpath expr="//form" position="attributes">
        <attribute name="string">academy_student_form</attribute>
      </xpath>

      <xpath expr="//div[@name='button_box']" position="inside">
        <button name="view_enrolments" type="object" class="oe_stat_button oe_read_only"
          icon="fa-sign-in" help="View student enrolments">
          <field name="enrolment_str" widget="statinfo" string="Enrolments"/>
        </button>
      </xpath>

      <xpath expr="//field[@name='id']" position="after">
          <field name="current_enrolment_ids" invisible="1" />
      </xpath>

      <xpath expr="//notebook/page[1]" position="before">
        <page string="Enrolments" class="oe_page_enrolments" accesskey="E" autofocus="autofocus">
          <field name="enrolment_ids" class="oe_field_current_enrolment_ids"
            domain="[('is_current', '=', True)]"
            context="{'list_view_ref': 'academy_base.view_academy_training_action_enrolment_tree_embed'}" />
        </page>
      </xpath>

      <xpath expr="//group[@id='page-details-main']" position="inside">
        <group colspan="4">
          <field name="signup_code" class="oe_field_signup_code" string="Sign-up code" readonly="1"/>
        </group>
        <group colspan="4">
          <field name="signup_date" class="oe_field_signup_date" readonly="not signup_code" />
        </group>
        <group colspan="4" class="d-flex justify-content-end">
          <button name="perform_signup" string="Sign up" type="object" invisible="signup_code" />
          <button name="revoke_signup" string="Opt out" type="object" invisible="not signup_code" confirm="Are you sure you want to do this?"/>
        </group>
        <group colspan="12" string="Per-company sign-up data" groups="base.group_no_one">
          <field name="signup_ids" class="oe_field_signup_ids" nolabel="1">
            <list string="Sign-up" create="0" delete="1" edit="1" editable="bottom">
              <field name="company_id" class="oe_field_company_id" />
              <field name="signup_code" class="oe_field_signup_code" />
              <field name="signup_date" class="oe_field_signup_date" />
            </list>
          </field>
        </group>
      </xpath>
    </field>
  </record>

  <record id="view_academy_student_kanban" model="ir.ui.view">
    <field name="name">view.academy.student.kanban</field>
    <field name="model">academy.student</field>
    <field name="type">kanban</field>
    <field name="mode">primary</field>
    <field name="priority" eval="16"/>
    <field name="active" eval="True"/>
    <field name="inherit_id" ref="academy_base.view_academy_support_staff_kanban"/>
    <field name="arch" type="xml">
      <xpath expr="//kanban" position="attributes">
        <attribute name="string">academy_student_kanban</attribute>
      </xpath>
      <xpath expr="//img[@id='default-avatar']" position="attributes">
          <attribute name="src">/academy_base/static/src/img/student-128.png</attribute>
      </xpath>
      <xpath expr="//field[@name='vat']" position="before">
        <field name="signup_code" />
      </xpath>

      <xpath expr="//ul/li[last()]" position="after">
        <li class="d-flex flex-row justify-content-start lh-lg text-truncate" t-att-title="record.vat.raw_value">
          <strong class="pe-2">VAT:</strong>
          <span t-if="record.vat.raw_value"><t t-esc="record.vat.raw_value" /></span>
          <span t-else="">---</span>
        </li>

        <li class="d-flex flex-row justify-content-start lh-lg text-truncate" t-att-title="record.signup_code.raw_value">
          <strong class="pe-2">Code:</strong>
          <span t-if="record.signup_code.raw_value"><t t-esc="record.signup_code.raw_value" /></span>
          <span t-else="">---</span>
        </li>
      </xpath>

      <xpath expr="//field[@name='activity_ids']" position="before">
        <button name="view_enrolments" type="object" class="btn my-0 py-0" string="Student enrolments">
          <i class="fa fa-lg fa-sign-in me-2" aria-hidden="true" title="View student training action enrolments"></i>
          <field name="enrolment_count" class="oe_field_enrolment_count" />
        </button>
      </xpath>

    </field>
  </record>

  <!-- Search view for "academy.student" -->
  <record id="view_academy_student_search" model="ir.ui.view">
    <field name="name">view.academy.student.search</field>
    <field name="model">academy.student</field>
    <field name="type">search</field>
    <field name="mode">primary</field>
    <field name="priority" eval="16"/>
    <field name="active" eval="True"/>
    <field name="inherit_id"/>
    <field name="inherit_id" ref="academy_base.view_academy_support_staff_search"/>
    <field name="arch" type="xml">
      <xpath expr="//search" position="attributes">
        <attribute name="string">academy_student_search</attribute>
      </xpath>

      <xpath expr="//field[@name='name']" position="replace">
        <field name="name"
          filter_domain="['|', '|', '|', '|', ('complete_name', 'ilike', self), ('signup_code', 'ilike', self), ('email', 'ilike', self), ('vat', 'ilike', self), ('company_registry', 'ilike', self)]"/>
      </xpath>

      <xpath expr="//field[@name='id']" position="after">
        <separator/>
        <filter name="enroled" string="Enroled" domain="[('current_enrolment_count', '>', 0)]"/>
        <filter name="not_enrolled" string="Not Enroled"
          domain="[('current_enrolment_count', '=', 0)]"/>
      </xpath>

    </field>
  </record>

  <!-- Main window action for model.name -->
  <record id="action_student_act_window" model="ir.actions.act_window">
    <field name="type">ir.actions.act_window</field>
    <field name="name">Students</field>
    <field name="res_model">academy.student</field>
    <field name="view_mode">kanban,list,form,activity</field>
    <field name="path">academy-student</field>
    <field name="target">current</field>
    <field name="domain"
      eval="[('id', '&lt;&gt;', ref('academy_base.academy_student_default_template'))]"/>
    <field name="context">{}</field>
    <field name="search_view_id" ref="view_academy_student_search"/>
    <field name="help" type="html">
      <p class="oe_view_nocontent_create"> Click to add new students </p>
      <p> There are no students yet </p>
    </field>
  </record>

  <!-- Main menu for model.name -->
  <record id="menu_student" model="ir.ui.menu">
    <field name="name">Students</field>
    <field name="sequence" eval="15"/>
    <field name="action" ref="action_student_act_window"/>
    <field name="parent_id" ref="academy_base.menu_academy_community"/>
    <field name="groups_id" eval="[(4, ref('academy_base.academy_group_technical'))]"/>
  </record>

</odoo>
